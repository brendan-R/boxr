---
title: "Box Interactive-Apps"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{auth-jwt}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE, message=FALSE}
library("conflicted")
library("here")
library("fs")

# this is a bit of a hack - this code is at the start of *each* of the vignettes;
# I would prefer that it appear once

# We want to keep a *single* copy of the figures for the entire site. The 
# reference copy of the figures is in the package directory `man/figures`.
# The first thing we do in this vignette is to copy that directory 
# to an the `vignettes`

dir_source <- here::here("man/figures")
dir_target <- here::here("vignettes")
dir_target_figures <- file.path(dir_target, "figures")

if (dir_exists(dir_target_figures)) {
  dir_delete(dir_target_figures)
}

dir_copy(dir_source, dir_target)
```

To interact programatically with the Box API, i.e. to use `boxr`, two things have to be done:

1. A Box application (app) has to be set up.
2. You have to authenticate to the app.

There are two different types of apps, contrasted in this [overview vignette](./box-apps.html). In this vignette, we discuss the interactive-app, which is designed (unsurprisingly) for interactive use. A user authenticates to this app using the "OAuth Dance", then accesses Box through this app, with the privileges of their Box user-account.

How you use this vignette depends on your Box set-up; we cover these situations:

1. Someone in your Box organization has already created an interactive-app. This means that you have available two character strings that correspond to `client_id` and `client_secret`. If that's the case, you need only the first section of this vignette, focused on users.

    - A special case of interactive use arises when you are using RStudio Server. We cover how to move your interactive token to the Server instance.

2. You have to create a Box interactive-app, meaning you you have to create the `client_id` and `client_secret`. In that case, you will need the second section of this vignette, followed by the first section.

Please keep in mind that if your Box account is controlled by an organization, e.g. you use Box at work, the creation and use of Box apps may be controlled by your Box-admin team. If this is the case, you might refer them to this vignette as a part of a request to have an app created.

```{r}
library(boxr)
```

## Using an Interactive App




## Creating an Interactive App

## Authorizing from a local computer

**1. 'Create New App'**

Go to [https://app.box.com/developers/console](https://app.box.com/developers/console), (when you are logged in) and click on the button 'Create New App', which will guide you through four screens to create your new app.

* On the first, select **Custom App** and click 'Next'.
* On the second, select **Standard OAuth 2.0 (User Authentication)** and click 'Next'
* On the third, choose a unique name for your app, this can be anything and click 'Next'
* The fourth screen should be a confirmation of successful creation, click 'View Your App'

![Four steps](figures/four_steps.png)


**2. Set OAuth2 Parameters**

'View Your App' will take you to the **Box Developers Console** and where you will be in the **Configuration** sub-menu by default. Scroll down to **OAuth 2.0 Redirect URI** and set it to `http://localhost` and be sure to click 'Save Changes'.

![Set Redirect URI](figures/redirect_uri.png)


Keep this browser window open because you will need the client_id and client_secret for the next steps back in `R`.

**3. Connect boxr to your account**
This means passing your client_id and client_secret to the `box_auth` function. These strings are not enough for someone to access your account maliciously. However, it's still a good idea to keep them safe, and out of any files or code which might be shared with others.

Run:

```{r, eval=FALSE}
library(boxr)
box_auth()
```

And paste/type the `client_id` and `client_secret` when prompted. If these are valid, a browser window should open, for you to formally grant yourself access to your files at box.com.


**4. And you're done**
If `box_auth()` worked successfully, you won't need to do any of this again, and thanks to the magic of `httr` everything should *just work*. Your client_id and client_secret will be securely stored in your R environment variables, your hashed OAuth2.0 token will stored at `~/.boxr-oauth`, .gitignore'd if necessary, and automatically refreshed when needed. If you would like to automatically authenticate each time the package is loaded, consider running `box_auth_on_attach(TRUE)`.

## Managing your client id & secret

To make you following authentications easier to, you may wish to put your client id and secret into your `.Renviron` file:

```bash
BOX_CLIENT_ID="youridhere"
BOX_CLIENT_SECRET="yoursecrethere"
 
```

Please make sure that your `.Renviron` file ends with a newline.